"0","library(rgdal)"
"0","library(dplyr)"
"0","library(plyr)"
"0","library(ggplot2)"
"0","library(rgeos)"
"0","library(tidyr)"
"0","#reads the full data"
"0","well_being_index_data <- read.csv(""london-ward-well-being-probability-scores-data.csv"")"
"0","#selects relevant columns: borough (4) and all crime levels (25:29) and stores in crime_data. Note boroughs are repeated because data is for wards"
"0","crime_data <- well_being_index_data[c(2:661),c(4,25:29)]"
"0","crime_data$Crime.rate...2009 <- as.numeric(as.character(crime_data$Crime.rate...2009))"
"0","#adds new column names to crime_data"
"0","colnames(crime_data) <- c(""borough"", ""crime_rate_2009"", ""crime_rate_2010"", ""crime_rate_2011"",""crime_rate_2012"",""crime_rate_2013"")"
"0","#calculates the average crime level data per year for each borough"
"0","crime_data_borough_averages <- aggregate(crime_data[, 2:6], list(crime_data$borough), mean)"
"0","#sets new column names"
"0","colnames(crime_data_borough_averages) <- c(""borough"", ""crime_rate_2009"", ""crime_rate_2010"", ""crime_rate_2011"",""crime_rate_2012"",""crime_rate_2013"")"
"0","#calculates the growth of crime per borough"
"0","growth <- (crime_data_borough_averages$crime_rate_2013 - crime_data_borough_averages$crime_rate_2009)/crime_data_borough_averages$crime_rate_2009*100"
"0","crime_data_borough_averages$growth <- growth"
"0","#Reads boroughs data as SpatialPolygonsDataFrame"
"0","london_boroughs <- readOGR(dsn = ""LondonBoroughs.shp"") "
"1","OGR data source with driver:"
"1"," "
"1","ESRI Shapefile"
"1"," "
"1","
"
"1","Source: """
"1","LondonBoroughs.shp"
"1",""", layer: """
"1","LondonBoroughs"
"1",""""
"1","
"
"1","with"
"1"," "
"1","33"
"1"," "
"1","features"
"1","
"
"1","It has"
"1"," "
"1","8"
"1"," "
"1","fields"
"1","
"
"1","Integer64 fields read as strings: "
"1"," "
"1","Pop_2001 PopDensity PopDen"
"1"," "
"1","
"
"0","#the line belows does the same as the merging "
"0","london_boroughs@data <- left_join(london_boroughs@data, crime_data_borough_averages, by = c('name' = 'borough'))"
"0","london_boroughs_f <- fortify(london_boroughs)"
"0","london_boroughs$id <- row.names(london_boroughs)# allocate an id variable to the sp d"
"0","london_boroughs_f <- left_join(london_boroughs_f, london_boroughs@data) # join the data"
"0","#changes the structure of the dataset to be able to plot it to a graph"
"0","london_boroughs_f_long <- gather(london_boroughs_f, crime_rate_year, crime_rate, -long, -lat, -order, -hole,-piece,-id,-group,-ons_label,-name,-Partic_Per,-Pop_2001, -PopDensity, -AREA, -PERIMETER, -PopDen, -growth)"
"0","ggplot(data = london_boroughs_f_long, # the input data"
"0","       aes(x = long, y = lat, fill = crime_rate, group = group)) + # define variables"
"0","  geom_polygon() + # plot the boroughs"
"0","  geom_path(colour=""white"", lwd=0.05) + # borough borders"
"0","  coord_equal() + # fixed x and y scales"
"0","  facet_wrap(~ crime_rate_year) + # one plot per year"
"0","  scale_fill_gradient2(low = ""#E3F2FD"",high = ""#1565C0"", # colors"
"0","                        name = ""Crime rate"") + # legend options"
"0","  theme(axis.text = element_blank(), # change the theme options"
"0","        axis.title = element_blank(), # remove axis titles"
"0","        axis.ticks = element_blank()) # remove axis ticks"
