{
    "collab_server" : "",
    "contents" : "---\ntitle: \"project_a\"\nauthor: \"maria\"\ndate: \"9/20/2017\"\noutput:\n  pdf_document: default\n  html_document: default\n---\n```{r packages, echo = FALSE, message=FALSE, warning=FALSE,}\nlibrary(readxl)\nlibrary(ggplot2)\nlibrary(knitr)\nlibrary(dplyr)\nlibrary(rlang)\nlibrary(dplyr)\nlibrary(tidyr)\n# BEGIN libraries for map !!! You might need to install these ones\nlibrary(rgdal)\nlibrary(plyr)\nlibrary(rgeos)\n# END libraries for map\n\n```\n\n#Analysing crime in London\n\n```{r, echo = FALSE}\ncrime <- read_excel(\"Official_data/london-ward-well-being-probability-scores.xls\", sheet = \"Data\")\n# data by borough\ncrime_borough <- crime[c(2,629:660),]\ncrime_borough[,5:ncol(crime_borough)] <- sapply(crime_borough[,5:ncol(crime_borough)],as.numeric)\n# data by ward\ncrime_ward <- crime[2:626,]\ncrime_ward[,5:ncol(crime_ward)] <- sapply(crime_ward[,5:ncol(crime_ward)],as.numeric)\nsummary(crime_ward[,29])\n\n\n```\n\n\n## Introduction\nModern policy regarding crime rate has transitioned to a focus on preventative measures as opposed to consequential punishment. As outlined by Crawford and Evans (2017) these policies focus on early intervention and improving well-being to secure community safety. A comprehensive understanding of demographic variables that are highly correlated and plausibly causing crime rates is necessary for developing robust policies. Crime rate in London varies drastically by area. In 2013, crime rates ranged from 13.93 to 222.92, with a mean of 82.40 and a standard deviation of 30. With such drastically different levels of crime and significant outliers, there must be an underlying explanation.\n\nThe dataset used in this report is from London datastore, an open data-sharing platform with statistics provided from the London mayoral office. The data is from 2013 and its original purpose was to assign a well-being score to different wards in London through measurements of 12 different indicators such as childhood obesity and deliberate fires. However, this report will focus on crime rates in London and explore the relationships between these rates and other demographic features of wards. It will attempt to model crime based on these additional indicators of well-being. Any significant results may prove to be insightful for policy makers considering local crime rates.\n\n## Dataset description\nInformation on the 12 key indicators of well-being are given for 625 wards in London over a four-year time frame from 2009 to 2013. Additional borough-wide information is provided for the 32 London boroughs. The variables are split into 8 different categories, detailed below, aiming to give a holistic view of the standard of well-being in the different areas of the capital.\n\n### Variables\n\n```{r, echo = FALSE}\nVariables <- read_excel(\"./Official_data/Variables.xlsx\")[,1:3]\nVariables[2:3,1] <- \"\"\nVariables[2:3,1] <- \"\"\nVariables[6,1] <- \"\"\nkable(Variables)\n```\n\n\n## Strength and limitations\n\nSome text needs to be added here\n\n## Overview analysis\n### Crime by borough\n\nFrom 2009 to 2013, the crime rates of all boroughs in London have decreased. As seen in the maps of figure below, the boroughs in the outskirts of London seem to have a lower crime rate than the boroughs in the center of London with exception to the City of London. \n\n```{r crime_by_borough, message=FALSE, warning=FALSE, results='hide',echo=FALSE,fig.cap=\"Crime rate by borough from 2009 to 2013\"}\n#selects relevant columns: borough (4) and all crime levels (25:29) and stores in crime_data_by_borough. Note boroughs are repeated because data is for wards\n\ncrime_data_by_borough <- crime_borough[c(4,25:29)]\n\n#adds new column names to crime_data_by_borough\ncolnames(crime_data_by_borough) <- c(\"borough\", \"2009\", \"2010\", \"2011\",\"2012\",\"2013\")\n\n#calculates the average crime level data per year for each borough\ncrime_data_borough_averages <- aggregate(crime_data_by_borough[, 2:6], list(crime_data_by_borough$borough), mean)\n\n#adds new column names to crime_data_borough_averages\ncolnames(crime_data_borough_averages) <- c(\"borough\", \"2009\", \"2010\", \"2011\",\"2012\",\"2013\")\n\n#calculates the growth of crime per borough\ngrowth <- (crime_data_borough_averages$`2013` - crime_data_borough_averages$`2009`)/crime_data_borough_averages$`2009`*100\n\n#Adds growth vector to crime_data_borough_averages\ncrime_data_borough_averages$growth <- growth\n\n#Reads boroughs data as SpatialPolygonsDataFrame\nlondon_boroughs <- readOGR(dsn = \"Official_data/Map_data/LondonBoroughs.shp\") \n\n#joins london_boroughs@data with crime_data_borough_averages based on the borough\nlondon_boroughs@data <- left_join(london_boroughs@data, crime_data_borough_averages, by = c('name' = 'borough'))\n\nlondon_boroughs_f <- fortify(london_boroughs)\n# allocate an id variable to the sp d\nlondon_boroughs$id <- row.names(london_boroughs)\n# join the data\nlondon_boroughs_f <- left_join(london_boroughs_f, london_boroughs@data) \n\n#changes the structure of the dataset to be able to plot it to a graph\nlondon_boroughs_f_long <- gather(london_boroughs_f, crime_rate_year, crime_rate, -long, -lat, -order, -hole,-piece,-id,-group,-ons_label,-name,-Partic_Per,-Pop_2001, -PopDensity, -AREA, -PERIMETER, -PopDen, -growth)\n\nggplot(data = london_boroughs_f_long, # the input data\n       aes(x = long, y = lat, fill = crime_rate, group = group)) + # define variables\n  geom_polygon() + # plot the boroughs\n  geom_path(colour=\"white\", lwd=0.05) + # borough borders\n  coord_equal() + # fixed x and y scales\n  facet_wrap(~ crime_rate_year) + # one plot per year\n  scale_fill_gradient2(low = \"#64B5F6\",high = \"#2196F3\", # colors\n                        name = \"Crime rate\") + # legend options\n  theme(axis.text = element_blank(), # change the theme options\n        axis.title = element_blank(), # remove axis titles\n        axis.ticks = element_blank()) # remove axis ticks\n\n\n\n```\n\nCity of London, remains with the lowest rate of crime across all boroughs with only 14 offences per 1,000 daytime inhabitants in 2013. In contrast, its neighbouring boroughs as Lambeth, Hackney, Southwark and Islington continue to present a crime rate of over 100. The map below shows the quartile with the highest number of crime rates in London (crime rate over 90). These boroughs are mainly located to the upper and lower side from the City of London. \n\n```{r boroughs_with_high_crime_rate, message=FALSE, warning=FALSE, results='hide',echo=FALSE, fig.height = 4, fig.width = 5, fig.cap=\"Crime rate > 90 (2013)\"}\n#plots the boroughs with highest crime rate of 100\nggplot(london_boroughs_f, aes(long, lat, group = group, fill=`2013`>90)) +\n  geom_polygon() + geom_path(colour=\"white\", lwd=0.05) + coord_equal() +\n  labs(x = \"lat\", y = \"lon\",\n       fill = \"Crime rate > 90\") +\n  scale_fill_manual(values=c(\"#BDBDBD\",\"#2196F3\")) +\n  ggtitle(\"Crime rate > 90 (2013) \") +\n  theme(axis.text = element_blank(), # change the theme options\n        axis.title = element_blank(), # remove axis titles\n        axis.ticks = element_blank()) # remove axis ticks\n```\n\nOn average, boroughs have lowered their crime rates by 19% from 2009 to 2013. The boroughs that seem to be showing the highest decrease in crime rate are on the further southeast of London, as for instance in Greenwich, Barking and Dagenham and Lewisham. The boroughs with the least progress in decreasing crime are Tower Hamlets, Enfield and Kensington and Chelsea. \n\n```{r crime_rate_growth, message=FALSE, warning=FALSE, results='hide',echo=FALSE, fig.height = 4, fig.width = 5, fig.cap=\"Decrease of crime rates by borough from 2009 to 2013\"}\nggplot(data = london_boroughs_f, # the input data\n       aes(x = long, y = lat, fill = growth, group = group)) + # define variables\n  geom_polygon() + # plot the boroughs\n  geom_path(colour=\"white\", lwd=0.05) + # borough borders\n  ggtitle(\"Decrease of crime rates by borough from 2009 to 2013 \") +\n  coord_equal() + # fixed x and y scales\n  scale_fill_gradient2(low = \"#66BB6A\",high = \"#4CAF50\", # colors\n                        name = \"Decrease (%)\") + # legend options\n  theme(axis.text = element_blank(), # change the theme options\n        axis.title = element_blank(), # remove axis titles\n        axis.ticks = element_blank()) # remove axis ticks\n```\n\n### Crime historically\n\n###AMR###\n\n###TEXT: added some intro text. Check with Maria if it is needed for report###\nCrime, in general, is very hard to measure and as in various big cities around the world, measuring crime in London is no easy task. Police statistics is usually the only measure to local crime. However, police crime figures are not always accurate as they tend to understate recorded crime statistics. Accordingly, crime statistics needs to be investigated with caution; sometimes data from hospitals intakes or victim surveys infer very different theories. Geographically, London is divided into 32 boroughs and each borough consists of multiple wards. During our analysis, we will look at crimes rates across the 32 boroughs along 5 years; from 2009 till 2013.\n\nAnalyzing crime data across London benefit both the governmental organizations and the individuals. For example, organizations can use the data to implement better services and check for core reasons why crime in one area is higher than the other, while, individuals can utilize this data to make calculated decisions on where to buy or rent a house in London. \n\nOur dataset measures the well-being scores across all London's wards. In our analysis, we will look at how different factors affect crime rates in different areas, such as how do unemployment rate affect crime rates or how GSCE test score relate to the crime rates. We will investigate the relationship between crime and different factors using linear regression tests and other statistical tests such as hypothesis test.\n###TEXT###\n\n```{r}\n\n# selects relevant data from the whole dataset. Borough and crime rate on each of the 5 years.\ncrime_by_year <- crime_borough[, c(4, 25:29)]\n\n# changes the names of the coloumns\ncolnames(crime_by_year) <- c(\"Borough\", \"Crime_Rate_2009\", \"Crime_Rate_2010\", \"Crime_Rate_2011\",\"Crime_Rate_2012\",\"Crime_Rate_2013\")\n\n# plot the crime rate of 2009 for each borough\nggplot(crime_by_year, aes(Borough, Crime_Rate_2009)) +\n  geom_bar(stat = \"identity\") +\n  theme(axis.text = element_text(angle = 45, hjust = 1)) +\n  ylim(0, 150)\n\n# plot the crime rate of 2010 for each borough\nggplot(crime_by_year, aes(Borough, Crime_Rate_2010)) +\n  geom_bar(stat = \"identity\") +\n  theme(axis.text = element_text(angle = 45, hjust = 1)) +\n  ylim(0, 150)\n\n# plot the crime rate of 2011 for each borough\nggplot(crime_by_year, aes(Borough, Crime_Rate_2011)) +\n  geom_bar(stat = \"identity\") +\n  theme(axis.text = element_text(angle = 45, hjust = 1)) +\n  ylim(0, 150)\n\n# plot the crime rate of 2012 for each borough\nggplot(crime_by_year, aes(Borough, Crime_Rate_2012)) +\n  geom_bar(stat = \"identity\") +\n  theme(axis.text = element_text(angle = 45, hjust = 1)) +\n  ylim(0, 150)\n\n# plot the crime rate of 2013 for each borough\nggplot(crime_by_year, aes(Borough, Crime_Rate_2013)) +\n  geom_bar(stat = \"identity\") +\n  theme(axis.text = element_text(angle = 45, hjust = 1)) +\n  ylim(0, 150)\n\n###Ask Valeria on how to put the 5 plots on one plot (just like the maps one)###\n\nsummary(crime_by_year)\n\n\n#Average crime over the 5 years, per borough\naverage <- crime_by_year %>% mutate(average = (Crime_Rate_2009 + Crime_Rate_2010 + Crime_Rate_2011 + Crime_Rate_2012 + Crime_Rate_2013)/ 5)\n\n\nggplot(average, aes(Borough, average)) +\n  geom_bar(stat = \"identity\") +\n  theme(axis.text = element_text(angle = 45, hjust = 1)) +\n  ylim(0, 150)\n\nggplot(average, aes(Borough, average)) +\n  geom_point() +\n  theme(axis.text = element_text(angle = 45, hjust = 1))\n\n```\n\nLooking at crime rates across the five years, we can see clear trend of crime rates decreasing from 2009 till 2013 across all the London boroughs. The bar plots, for each year, show the crim rates per borough for that specific year. If you compare the 5 plots, you will notice that the crime rates are decreasing year by year.\n\nThe scatter plot shows the average crime rate (over the 5 years) across each borough. One thing to note, is the City of London, which has the lowest crime rate across all of London. \n\n\n# Correlation Analysis\nThe correlation analysis in this report adopts the Pearson correlation coefficient, denoted r, with the aim to examine the strength and direction of the linear relationship between two continuous variables, i.e. crime rate and one other rates.The correlation coefficient ranges from −1 to +1, and stronger relationship between two variables as larger absolute value of the coefficient. Positive coefficient means both variables tend to increase or decrease together whereas negetive coefficient means two variables have opposite directions (Zhou et al., 2016).\n\nThe following correlation analysis does not conclude that changes in one variable cause changes in crime rate or changes in creime rate cause in other variable. This analysis will not tell whether a relationship is causal.\n\n```{r}\n#the following loop can produce long table \nvar_list = c(\"life_expectancy\",\"childhood_obesity\",\"incapacity_benefit\",\"unemployment_rate\",\"crime_rate\",\"deliberate_fires\",\"GCSE_point\",\"unauthorised_absence\",\"dependent_children\",\"public_transport\",\"home_access\")\n\ncrime_ward_long = data.frame()\nfor (i in 1:length(var_list)) {\n  temp <- select(crime_ward, Ward, Borough, (i*5):(i*5+4))\n  colnames(temp)[3:7] <- c(2009:2013)\n  tidytemp <- gather_(temp, \"year\", var_list[i], colnames(temp)[3:7])\n  if (i==1) {\n    crime_ward_long <- tidytemp\n  } else {\n    crime_ward_long <- cbind(crime_ward_long, tidytemp[,4])\n  }\n}\ngb <- crime_ward_long %>% dplyr::group_by(year)\n\n```\n```{r}\n# the codes below define a function that allows you to make scatters boxplot with correlation on them\n# argument: col_name, string with double quotes, e.g. \"unemployment_rate\"\ncor_plot <- function(col_name) {\n  corr <- dplyr::summarise(gb,r=round(cor(!!sym(col_name),crime_rate),4))\n  print(ggplot(crime_ward_long,aes_string(x=col_name,y=\"crime_rate\"))+geom_point(alpha=0.2)+\n    facet_wrap(~ year, nrow=2) +\n    geom_smooth() +\n    geom_text(data=corr, aes(label=paste(\"r=\",r,sep=\"\")),x=quantile(gb[[col_name]],0.9),y=270) )\n}\n# cor_plot(\"unemployment_rate\")\n```\n## Correlations between crime rate and 3 health-related indexes\n### Description\nThese three health-realated indexes including rolling 5-year combined life expectancies, prevalence of obsity by area of child residence, and incapcaity benefit or servere disablement allowance claimant rate.\n### Life Expectancy\nAccording to the data description provided by London datastore, rolling 5-year combined life expectancies instead of simple one-year life expectancies are used for wards to reduce the efffects of the variability in number of deaths in each year.\nA study in 2015 reviewed that biological aging processes may be impacted by socioeconomic milieu, meaning that those who living in noisy area with high crime may have shorter cellular aging estimated by leukocyte telomere length (Park et al., 2015). Therefore, it is reasonable to estimate that a negative correlation between crime rate and life expectancy.\n\n\n```{r}\ncor_plot(\"life_expectancy\")\nggplot(gb, aes(x=cut(childhood_obesity, breaks =20), y=crime_rate))+geom_boxplot()+facet_wrap(~year)\n```\nFrom the above scatter points in different years, weak-to-moderate negative relationship between crime rate and life expectancy can be found, with Pearson r from -0.3631 to 0.4545 in 5 different years. Also, a significant portion of points are far from the smooth line indicates only a moderate linear relationship between the variables.\n\n### Childhood Obesity\nThis estimates use the latest three years of National Child Measurement Programme (NCMP) data combined. This means, the data in 2013 is the average of data in 2011, 2012, and 2013. In addition, children with a Body Mass Index (BMI) greater than or equal to the 95th centile of the British 1990 growth reference (UK90) BMI distribution have been classified as obese.\n\nAn et al. (2017) revealed a  modest relationship between residential neighbourhood safety and weight-related behaviours/outcomes among children and adolescents through examing 22 studies, Half of which conducted in the USA, and one of which was conducted in a developing country. There analysis suggested that living in district with relatively high crime rate  was associated with a reduction in children's physical activity, and therefore gain in body mass index, but no change in childhood obesity risk.\nTherefore, we expect childhood obesity rate and crime rate have moderate positive correlation before actually conducting the analysis.\n\n```{r}\ncor_plot(\"childhood_obesity\")\nggplot(gb, aes(x=cut(childhood_obesity, breaks =20), y=crime_rate))+geom_boxplot()+facet_wrap(~year)\n```\nSimilar to the correlation between crime rate and life expectancy, crime rate and childhood obesity share a weak-to-moderate positive relationship, with Pearson r's range from 0.372 to 0.389.\nThe analysis results confirm our expectation based on the study conducted by An et al. (2017).\nIt is noticebaly that expect for in year 2013, wards that have extremely high childhood obesity score tend to have lower crime rate, the phenomenon violate the moderate positive relationship between the two variables.\n\n###Incapacity Benefit\nIncapacity Benefit rate represents Incapacity Benefit or Severe Disablement Allowance claimant rate.Incapacity Benefit (IB) is paid to people who are incapable of work and who meet certain contribution conditions and Severe Disablement Allowance (SDA) is paid to those unable to work for 28 weeks in a row or more because of illness or disability.\n```{r}\ncor_plot(\"incapacity_benefit\")\nggplot(gb, aes(x=cut(childhood_obesity, breaks =20), y=crime_rate))+geom_boxplot()+facet_wrap(~year)\n```\nAgain crime rate and incapacity benefit rate have a moderate positive relationship according to Pearson r's range from 0.3917 to 0.4752 in different years.\nAlthough the maximum incapacity benefit rate decreased continously from around 15% in 2009 to around 5% in 2013, wards with highest incapacity benefit rates have relatively low crime rates in all 5 years.  \nA number of wards have relatively high crime rates while having similar incapacity benefit rates as other wards. This may indicate that crime rate correlates to not only incapacity benefit but also other variables.\n\nIn conclusion, moderate correlations are found between crime rate and three health-related rates. The moderate correlations may be explained by many extreme data values since the Pearson correlation coefficient is very sensitive to extreme data values. A single value that is very different from the other values in a data set can greatly change the value of the coefficient. Many outliers, shown on the the above boxplots, may greatly affect the result of the correlation between crime rate and other variable.\n\n###unemployment_rate\nUnemployment rate here refers to percentage of working-age residents claiming Jobseeker's Allowance (JSA) or National Insurance Credits. JSA is a benefit payable to unemployed people. \nIntuitively, unemployment rate and crime rate should be positively correlated. Our scatter plot shows moderate positive correlation between the two variables, which confirmed our hypothesis. We can also find more extreme values for unemployment rate with time passing, although those increased unemployment are not necessarily associated with increased crime rate. \n\n```{r}\ncor_plot(\"unemployment_rate\")\n```\nWe also expect areas with considerately dense population (i.e. inner London) may potentially have more crimes even if the general employment rate are similar to suburban areas. If we split boroughs into inner and outer London, we can see employment and crime rate show only weak correlations of around 0.2 for innter London but stronger correlations (0.58-0.62) for outer London boroughs. \n```{r}\n# split borough into inner and outer\ndesig <- read.csv(\"./Official_data/borough_desig.csv\")\ncrime_ward_long_desig <- merge(crime_ward_long[2:nrow(crime_ward_long),],desig,by=\"Borough\")\ninner_ward <- crime_ward_long_desig%>% filter(Designation==\"Inner\")\nouter_ward <- crime_ward_long_desig%>% filter(Designation==\"Outer\")\ncorr <- inner_ward%>% group_by(year)%>%\n  dplyr::summarise(r=round(cor(unemployment_rate,crime_rate),4))\nggplot(inner_ward,aes(x=unemployment_rate,y=crime_rate))+geom_point(alpha=0.2)+\n  facet_wrap(~ year, nrow=2) +\n  geom_smooth() +\n  geom_text(data=corr, aes(label=paste(\"r=\",r,sep=\"\")),x=quantile(inner_ward$unemployment_rate,0.9),y=250) \n\ncorr <- outer_ward%>% group_by(year)%>%\n  dplyr::summarise(r=round(cor(unemployment_rate,crime_rate),4))\nggplot(outer_ward,aes(x=unemployment_rate,y=crime_rate))+geom_point(alpha=0.2)+\n  facet_wrap(~ year, nrow=2) +\n  geom_smooth() +\n  geom_text(data=corr, aes(label=paste(\"r=\",r,sep=\"\")),x=quantile(outer_ward$unemployment_rate,0.9),y=250) \n\nmean_desig <- crime_ward_long_desig%>% group_by(Designation)  %>% dplyr::summarise(avg_crime=mean(crime_rate))\nmean_desig\n```\n## Education\nGCSE scores and Unauthorised Pupil Absence are used to represent education well-being in our data. Not surprisingly, these two variables have negatively relationship with a correlation of -0.5979. \n\n```{r}\n# correlation between GCSE & unauthorised pupil absence\ncor(crime_ward_long$GCSE_point, crime_ward_long$unauthorised_absence)\n```\nCorrelations between education variables and crime rate are relatively weaker compared with unemployment. We also notice from the scatter that GCSE score has increased while unauthorised pupil absence has decreased from 2009 to 2013, indicating general education well-being has been improved in London's education. \n```{r}\n# plot education varialbes\ncor_plot(\"GCSE_point\")\ncor_plot(\"unauthorised_absence\")\n```\n### Dependent children\n\nDependent childing shows the percentage of children living in out-of-work benefit claimant households. A moderate positive correlation indicates that boroughs with higher dependent children percentage tends to have higher crime rate.\n```{r}\n# plot children varialbes\ncor_plot(\"dependent_children\")\n```\n\n# corr analysis last part\n### deliberate_fires\n```{r}\ncor_plot(\"deliberate_fires\")\n```\nThe correlation between crime rate and figure of deliberate fires per 1000 population is very weak throught the 5 years, correlation figure fluctuates around 0.13. Although deliberate fire expects to be a great indicator, as this directly relates to crime rate; the correlation figure shows a weak relationship. It is sugguested to have further investigations of this factor\n\n\n### Environment (Access to public open space and nature\tMeasure of proportion of area that is greenspace and accessibility from homes)\n```{r}\ncor_plot(\"home_access\")\n```\nIt is clearly seen from the graph x that there is almost no correlation between crime rate and environment, the correlation figures remained extremely low across 5 years. In common sense, we may expect the environment could be a potential drive of leading committing a crime, the result proves that people tend to be rational with their actions regardless of their surrounding environment\n\n### Access\tPublic Transport Accessibility Scores\tMeasure of the accessibility of a point to the public transport network\n```{r}\ncor_plot(\"public_transport\")\n```\nIn terms of public transport accessibility. There exists a clear moderate positive relationship with an increasing trend. for example, the correlation figure was 0.3784 in 2009, gradually increased to 0.4585 in 2012. Overall, the correlation figure remains around 0.42. The higher public transport accessibility people have, the crime rate tends to be higher. \n\n\n\t\n## Linear regression\n\n## Conclusion and analysis\n\n\n\n\n\n\n\n\n\n",
    "created" : 1506333418052.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2193552387",
    "id" : "49A8E441",
    "lastKnownWriteTime" : 1506509112,
    "last_content_update" : 1506509112943,
    "path" : "~/math_report/project_a.Rmd",
    "project_path" : "project_a.Rmd",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}